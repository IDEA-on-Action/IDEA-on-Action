# AdminUsers 관리 가이드

## 개요

### 목적
AdminUsers 페이지는 시스템 관리자 계정을 관리하는 Super Admin 전용 페이지입니다. 관리자 계정을 생성하고 역할(super_admin, admin, editor)을 부여할 수 있습니다.

### 주요 기능
- 관리자 계정 목록 조회
- 관리자 검색 및 필터링 (역할별)
- 관리자 계정 생성, 수정, 삭제
- 역할 변경 (super_admin, admin, editor)
- 사용자 이메일 검색

### 접근 권한
- **필요 권한**: Super Admin 전용
- **접근 경로**: `/admin/users`
- **권한 없을 경우**: "권한이 없습니다" 메시지 표시 및 접근 차단

---

## 화면 구성

### 권한 확인 화면
- **권한 없을 경우**:
  - 중앙 정렬된 경고 화면
  - 방패 아이콘 (ShieldAlert)
  - "권한이 없습니다" 제목
  - "이 페이지는 Super Admin만 접근할 수 있습니다." 설명

### 목록 화면 (Super Admin만 접근 가능)
- **상단**: 페이지 제목, "새 관리자" 버튼
- **검색 및 필터**:
  - 검색창: 이메일 또는 역할로 검색
  - 역할 필터: 전체 역할, Super Admin, Admin, Editor
- **테이블 컬럼**:
  - 이메일: 관리자 이메일 주소
  - 역할: 역할 뱃지 (Super Admin, Admin, Editor)
  - 생성일: 관리자 계정 생성일
  - 작업: 수정, 삭제 버튼

### 생성/편집 화면
- **모달 다이얼로그** 형태로 표시
- **폼 필드**:
  - 사용자 (생성 시에만): 이메일 검색으로 사용자 선택
  - 역할: super_admin, admin, editor 중 선택

---

## 기능 사용법

### 1. 조회

#### 목록 조회
1. `/admin/users` 페이지에 접속합니다.
2. **권한 확인**: Super Admin 권한이 없으면 "권한이 없습니다" 화면이 표시됩니다.
3. Super Admin 권한이 있으면 등록된 모든 관리자 계정이 테이블로 표시됩니다.
4. 각 관리자의 이메일, 역할, 생성일을 한눈에 확인할 수 있습니다.

#### 검색
1. 상단 검색창에 이메일 또는 역할의 일부를 입력합니다.
2. 입력과 동시에 실시간으로 필터링됩니다.
3. 검색어는 대소문자 구분 없이 동작합니다.

#### 필터링
- **역할 필터**:
  - 전체 역할: 모든 역할 표시
  - Super Admin: super_admin 역할만 표시 (빨간색 뱃지)
  - Admin: admin 역할만 표시 (파란색 뱃지)
  - Editor: editor 역할만 표시 (초록색 뱃지)

#### 정렬
- 기본 정렬: 최근 생성순 (created_at DESC)
- 테이블 헤더 클릭으로 정렬 변경 불가 (현재 버전)

---

### 2. 생성

#### 필수 입력 항목
- **사용자** (필수): 이메일 검색으로 선택 (최소 3자 이상 입력)
- **역할** (필수): super_admin, admin, editor 중 선택

#### 선택 입력 항목
- 없음 (사용자와 역할만 선택)

#### 폼 검증 규칙
- **사용자**: 유효한 사용자 ID 선택 필수
- **역할**: super_admin, admin, editor 중 하나 선택 필수

#### 사용자 검색 프로세스
1. "새 관리자" 버튼을 클릭합니다.
2. 모달 다이얼로그가 열립니다.
3. "사용자" 필드에 이메일을 3자 이상 입력합니다.
4. 300ms 디바운스 후 자동으로 사용자 검색이 시작됩니다.
5. 검색 중: "검색 중..." 메시지 표시
6. 검색 결과:
   - 결과가 있을 경우: 최대 높이 48 스크롤 가능한 목록으로 표시
   - 결과가 없을 경우: "검색 결과가 없습니다" 메시지 표시
7. 원하는 사용자를 클릭하여 선택합니다.
8. 선택한 사용자의 이메일이 입력창에 표시됩니다.

#### 저장 프로세스
1. 사용자를 검색하여 선택합니다.
2. 역할을 선택합니다 (Super Admin, Admin, Editor).
3. "저장" 버튼을 클릭합니다.
4. 저장 중: "저장 중..." 메시지 표시, 버튼 비활성화
5. 저장 완료: "관리자 생성 완료" 토스트 메시지 표시, 모달 닫힘
6. 저장 실패: "관리자 생성 실패" 토스트 메시지 표시, 오류 내용 표시

---

### 3. 수정

#### 수정 가능 항목
- 역할 (super_admin, admin, editor)

#### 수정 불가 항목
- ID (자동 생성)
- 사용자 (user_id, 생성 시에만 선택 가능)
- 이메일 (사용자와 연결됨)
- 생성일 (created_at)

#### 수정 프로세스
1. 테이블에서 수정하려는 관리자의 "수정" 버튼(연필 아이콘)을 클릭합니다.
2. 모달 다이얼로그가 열리고 기존 이메일과 역할이 표시됩니다.
3. **사용자 필드는 표시되지 않습니다** (수정 시에는 역할만 변경 가능).
4. 역할을 변경합니다.
5. "저장" 버튼을 클릭합니다.
6. 저장 완료: "관리자 수정 완료" 토스트 메시지 표시, 모달 닫힘
7. 저장 실패: "관리자 수정 실패" 토스트 메시지 표시, 오류 내용 표시

---

### 4. 삭제

#### 삭제 조건
- Super Admin 권한이 있는 사용자만 삭제 가능
- 삭제된 관리자 계정은 복구할 수 없음
- **주의**: 자기 자신을 삭제하지 않도록 주의하세요.

#### 연관 데이터 처리
- 관리자 계정 삭제 시 해당 사용자의 관리자 권한만 제거됩니다.
- 사용자 계정 자체는 삭제되지 않습니다 (일반 사용자로 전환).

#### 삭제 프로세스
1. 테이블에서 삭제하려는 관리자의 "삭제" 버튼(휴지통 아이콘)을 클릭합니다.
2. 삭제 확인 다이얼로그가 표시됩니다.
3. 메시지: "정말로 이 관리자를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."
4. "삭제" 버튼을 클릭하여 확인합니다.
5. 삭제 완료: "관리자 삭제 완료" 토스트 메시지 표시
6. 삭제 실패: "관리자 삭제 실패" 토스트 메시지 표시, 오류 내용 표시

---

## 주의사항

### 데이터 일관성
- **역할 권한**: Super Admin만 이 페이지에 접근할 수 있습니다.
- **자기 삭제 방지**: 자기 자신의 Super Admin 권한을 삭제하지 않도록 주의하세요. 다시 복구할 방법이 없습니다.
- **사용자 중복**: 한 사용자는 하나의 관리자 역할만 가질 수 있습니다. 이미 관리자인 사용자를 추가하려고 하면 오류가 발생합니다.

### 권한 관리
- **Super Admin 전용**: editor, admin 역할로는 이 페이지에 접근할 수 없습니다.
- **RLS 정책**: Supabase RLS 정책에서 super_admin 권한을 확인합니다.
- **useCurrentAdminRole 훅**: admins 테이블을 직접 조회하여 현재 사용자의 역할을 확인합니다.

### 에러 처리
- **권한 없음**: Super Admin이 아닌 경우 "권한이 없습니다" 화면 표시
- **네트워크 오류**: 네트워크 연결 실패 시 "알 수 없는 오류가 발생했습니다." 메시지 표시
- **필수 항목 누락**: 필수 항목 미입력 시 빨간색 오류 메시지 표시, 저장 불가
- **사용자 검색 실패**: Supabase Auth Admin API 호출 실패 시 "사용자 검색 실패" 토스트 메시지 표시
- **중복 관리자**: 이미 관리자인 사용자 추가 시도 시 오류 발생

---

## FAQ

### Q1: Super Admin 권한은 어떻게 부여하나요?
**A**: Super Admin 권한은 이 페이지에서 부여할 수 있습니다. 역할 선택 시 "Super Admin (모든 권한)"을 선택하세요. 단, 초기 Super Admin은 데이터베이스 마이그레이션이나 직접 SQL로 생성해야 합니다.

### Q2: 역할별 권한 차이는 무엇인가요?
**A**: 역할별 권한은 다음과 같습니다:
- **Super Admin**: 모든 권한 (관리자 계정 관리 포함)
- **Admin**: 대부분의 관리 기능 (관리자 계정 관리 제외)
- **Editor**: 콘텐츠 편집 권한 (일부 민감한 기능 제한)

### Q3: 사용자 검색이 안 되는 이유는 무엇인가요?
**A**: 사용자 검색이 안 되는 이유는 다음과 같을 수 있습니다:
- 검색어가 3자 미만
- 해당 이메일의 사용자가 존재하지 않음
- Supabase Auth Admin API 권한 문제
- 네트워크 연결 문제

### Q4: 관리자를 삭제하면 사용자 계정도 삭제되나요?
**A**: 아니요, 관리자를 삭제해도 사용자 계정은 삭제되지 않습니다. 해당 사용자의 관리자 권한만 제거되며, 일반 사용자로 전환됩니다.

### Q5: 관리자 역할을 변경하면 즉시 적용되나요?
**A**: 네, 관리자 역할을 변경하면 즉시 적용됩니다. 해당 사용자는 다음 페이지 로드 또는 권한 확인 시 변경된 역할로 동작합니다.

### Q6: 초기 Super Admin은 어떻게 생성하나요?
**A**: 초기 Super Admin은 다음 방법으로 생성할 수 있습니다:
1. 데이터베이스 마이그레이션 파일에서 생성
2. Supabase SQL 에디터에서 직접 INSERT
3. `verify-super-admin.js` 스크립트 실행

자세한 내용은 `docs/guides/database/super-admin-upgrade-guide.md`를 참조하세요.

### Q7: 관리자 계정은 몇 개까지 만들 수 있나요?
**A**: 관리자 계정 개수에 제한은 없습니다. 단, 보안을 위해 필요한 최소한의 관리자만 생성하는 것이 좋습니다.
