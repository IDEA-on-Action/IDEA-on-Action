name: Monthly Docs Maintenance

# ë§¤ì›” 1ì¼ 00:00 (UTC) = ë§¤ì›” 1ì¼ 09:00 (KST)
on:
  schedule:
    - cron: '0 0 1 * *'  # ë§¤ì›” 1ì¼
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

permissions:
  contents: write
  pull-requests: write

jobs:
  archive-completed-todos:
    name: Archive Completed TODOs
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Run archive script
        id: archive
        run: |
          node scripts/archive-completed-todos.js
          echo "archive_date=$(date +'%Y-%m')" >> $GITHUB_OUTPUT

      - name: Check for changes
        id: check_changes
        run: |
          if [[ -n $(git status --porcelain) ]]; then
            echo "has_changes=true" >> $GITHUB_OUTPUT
          else
            echo "has_changes=false" >> $GITHUB_OUTPUT
          fi

      - name: Create Pull Request
        if: steps.check_changes.outputs.has_changes == 'true'
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: |
            docs: ì›”ê°„ TODO ì•„ì¹´ì´ë¸Œ (${{ steps.archive.outputs.archive_date }})

            - ì™„ë£Œëœ ì‘ì—…ì„ ì•„ì¹´ì´ë¸Œë¡œ ì´ë™
            - project-todo.md ì •ë¦¬
            - ìë™ ìƒì„±: scripts/archive-completed-todos.js
          branch: docs/monthly-archive-${{ steps.archive.outputs.archive_date }}
          title: 'ğŸ“‹ ì›”ê°„ TODO ì•„ì¹´ì´ë¸Œ (${{ steps.archive.outputs.archive_date }})'
          body: |
            ## ğŸ“‹ ì›”ê°„ TODO ì•„ì¹´ì´ë¸Œ

            **ë‚ ì§œ**: ${{ steps.archive.outputs.archive_date }}
            **ìë™í™”**: GitHub Actions (monthly-docs-maintenance.yml)

            ### ë³€ê²½ ì‚¬í•­
            - âœ… ì™„ë£Œëœ ì‘ì—…ì„ `docs/archive/completed-todos-${{ steps.archive.outputs.archive_date }}.md`ë¡œ ì´ë™
            - âœ… `project-todo.md` ì •ë¦¬ (ì§„í–‰ ì¤‘/ëŒ€ê¸° ì¤‘ ì‘ì—…ë§Œ ìœ ì§€)

            ### ê²€ì¦ í•­ëª©
            - [ ] ì•„ì¹´ì´ë¸Œ íŒŒì¼ ë‚´ìš© í™•ì¸
            - [ ] project-todo.mdì— ì§„í–‰ ì¤‘ ì‘ì—… ìœ ì§€ í™•ì¸
            - [ ] ì™„ë£Œëœ ì‘ì—…ì´ ëª¨ë‘ ì•„ì¹´ì´ë¸Œë¡œ ì´ë™ë˜ì—ˆëŠ”ì§€ í™•ì¸

            ### ìë™ ìƒì„±
            ì´ PRì€ ë§¤ì›” 1ì¼ì— ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
            ë¬¸ì œê°€ ìˆë‹¤ë©´ PRì„ ë‹«ê³  ìˆ˜ë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ì„¸ìš”.

            ---
            ğŸ¤– Automated by GitHub Actions
          labels: |
            documentation
            automated
          reviewers: |
            ${{ github.repository_owner }}

      - name: Comment on PR
        if: steps.check_changes.outputs.has_changes == 'true'
        run: |
          echo "âœ… PR ìƒì„± ì™„ë£Œ: ì›”ê°„ TODO ì•„ì¹´ì´ë¸Œ (${{ steps.archive.outputs.archive_date }})"

      - name: No changes
        if: steps.check_changes.outputs.has_changes == 'false'
        run: |
          echo "â„¹ï¸  ì™„ë£Œëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤. PRì„ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
