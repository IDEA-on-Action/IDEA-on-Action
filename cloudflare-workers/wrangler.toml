# =============================================================================
# IDEA on Action - Cloudflare Workers 설정
# Supabase Edge Functions → Cloudflare Workers 마이그레이션
# =============================================================================

name = "idea-on-action-api"
main = "src/index.ts"
compatibility_date = "2024-12-01"

# 빌드 설정
[build]
command = "npm run build"

# 개발 환경
[dev]
port = 8787
local_protocol = "http"

# =============================================================================
# 환경 변수 (민감하지 않은 값만)
# =============================================================================
[vars]
ENVIRONMENT = "production"
API_VERSION = "2.39.1"
CORS_ORIGINS = "https://www.ideaonaction.ai,https://preview.ideaonaction.ai"

# =============================================================================
# KV Namespaces
# =============================================================================
[[kv_namespaces]]
binding = "SESSIONS"
id = ""

[[kv_namespaces]]
binding = "CACHE"
id = ""

[[kv_namespaces]]
binding = "RATE_LIMIT"
id = ""

# =============================================================================
# D1 Database
# =============================================================================
[[d1_databases]]
binding = "DB"
database_name = "idea-on-action-db"
database_id = ""

# =============================================================================
# R2 Storage
# =============================================================================
[[r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "idea-on-action-media"

# =============================================================================
# 라우팅
# =============================================================================
[[routes]]
pattern = "api.ideaonaction.ai/*"
zone_name = "ideaonaction.ai"

# =============================================================================
# 스테이징 환경
# =============================================================================
[env.staging]
vars = { ENVIRONMENT = "staging" }
routes = [
  { pattern = "api-staging.ideaonaction.ai/*", zone_name = "ideaonaction.ai" }
]

# =============================================================================
# 개발 환경
# =============================================================================
[env.development]
vars = { ENVIRONMENT = "development" }
