# 프롬프트 템플릿 관리 요구사항 명세서

> 사용자가 자주 사용하는 AI 프롬프트를 템플릿으로 저장하고 재사용하는 기능

**작성일**: 2025-11-25
**버전**: 1.0.0
**상태**: Active
**관련 백로그**: BL-AI-005

---

## 1. 개요

### 1.1 목적
AI 프롬프트를 템플릿으로 저장하여 반복 작업을 줄이고 생산성을 향상시킵니다.

### 1.2 범위
- 템플릿 CRUD (Create, Read, Update, Delete)
- 변수 치환 시스템
- 팀 공유 기능
- Minu 서비스 연동

### 1.3 대상 사용자
- Minu Find/Frame/Build/Keep 서비스 사용자
- 반복적인 AI 작업을 수행하는 PM, 기획자, 운영 담당자

---

## 2. 사용자 스토리

### US-PT-01: 템플릿 저장
> **As a** Minu 서비스 사용자
> **I want to** 만족스러운 AI 응답을 생성한 프롬프트를 템플릿으로 저장
> **So that** 다음에 같은 형식의 결과를 빠르게 얻을 수 있습니다

**인수 조건**:
- [ ] AI 생성 후 "템플릿으로 저장" 버튼 제공
- [ ] 이름, 설명, 카테고리 입력 가능
- [ ] 저장 성공 시 토스트 알림
- [ ] 변수가 있다면 자동으로 감지하여 저장

**사용자 여정**:
1. Minu 서비스에서 AI로 RFP 생성
2. 결과에 만족하여 "템플릿으로 저장" 클릭
3. 다이얼로그에서 이름 입력 (예: "정부 SI RFP 기본 템플릿")
4. 카테고리 선택 (rfp)
5. "저장" 버튼 클릭
6. 성공 토스트 표시

### US-PT-02: 템플릿 재사용
> **As a** Minu 서비스 사용자
> **I want to** 저장된 템플릿을 선택하여 AI 생성 실행
> **So that** 매번 같은 지시사항을 입력할 필요가 없습니다

**인수 조건**:
- [ ] 템플릿 선택 UI 제공 (드롭다운 또는 리스트)
- [ ] 템플릿 미리보기 가능
- [ ] 선택 시 프롬프트 자동 입력
- [ ] 변수가 있으면 입력 필드 표시

**사용자 여정**:
1. Minu Frame에서 "템플릿 사용" 버튼 클릭
2. 저장된 템플릿 목록 확인
3. "정부 SI RFP 기본 템플릿" 선택
4. 변수 입력 필드에 값 입력 (예: 프로젝트명, 예산)
5. "생성하기" 버튼 클릭
6. AI 응답 확인

### US-PT-03: 변수 치환
> **As a** Minu 서비스 사용자
> **I want to** 템플릿에서 {{변수}} 부분만 입력하여 생성
> **So that** 핵심 정보만 입력하고 나머지는 템플릿이 처리합니다

**인수 조건**:
- [ ] {{변수명}} 형식 지원
- [ ] 변수 자동 감지 및 추출
- [ ] 변수별 입력 필드 자동 생성
- [ ] 변수 렌더링 실시간 미리보기

**사용 예시**:
```
템플릿:
{{project_name}} 프로젝트의 요구사항 분석 문서를 작성해주세요.
예산은 {{budget}}원이며, 기간은 {{duration}}개월입니다.

변수 입력:
- project_name: "차세대 ERP 시스템"
- budget: "500,000,000"
- duration: "12"

렌더링 결과:
차세대 ERP 시스템 프로젝트의 요구사항 분석 문서를 작성해주세요.
예산은 500,000,000원이며, 기간은 12개월입니다.
```

### US-PT-04: 팀 공유
> **As a** 팀 리더
> **I want to** 좋은 템플릿을 팀원들과 공유
> **So that** 팀 전체의 AI 활용 품질이 향상됩니다

**인수 조건**:
- [ ] "팀과 공유" 토글 버튼 제공
- [ ] 팀 공개 템플릿은 팀원 모두가 조회 가능
- [ ] 수정/삭제는 소유자만 가능
- [ ] 공유 템플릿은 사용 횟수 추적

**사용자 여정**:
1. 내 템플릿 목록에서 공유할 템플릿 선택
2. 편집 화면에서 "팀과 공유" 토글 ON
3. 저장
4. 팀원이 템플릿 목록에서 "팀 공유" 탭 클릭
5. 공유된 템플릿 확인 및 사용

### US-PT-05: 시스템 기본 템플릿
> **As a** Minu 신규 사용자
> **I want to** IDEA on Action이 제공하는 기본 템플릿 사용
> **So that** 처음부터 프롬프트를 작성할 필요가 없습니다

**인수 조건**:
- [ ] RFP, 요구사항 분석, 프로젝트 계획 등 기본 템플릿 제공
- [ ] 시스템 템플릿은 읽기 전용
- [ ] "내 템플릿으로 복사" 기능 제공

---

## 3. 기능 요구사항

### FR-PT-01: 템플릿 생성
- **필수 필드**: `name`, `user_prompt_template`
- **선택 필드**: `description`, `system_prompt`, `category`, `variables`
- **자동 생성 필드**: `id`, `user_id`, `created_at`, `updated_at`
- **기본값**: `is_public: false`, `status: active`, `usage_count: 0`

### FR-PT-02: 템플릿 조회
- **내 템플릿**: 본인이 생성한 템플릿 목록
- **팀 템플릿**: `is_public = true`인 팀원의 템플릿
- **시스템 템플릿**: `user_id IS NULL`인 시스템 기본 템플릿
- **필터링**: 카테고리, 상태, 생성일
- **정렬**: 최근 사용순, 이름순, 사용 횟수순

### FR-PT-03: 템플릿 수정
- **권한**: 본인 소유 템플릿만 수정 가능
- **수정 가능 필드**: `name`, `description`, `user_prompt_template`, `system_prompt`, `category`, `variables`, `is_public`
- **수정 불가 필드**: `id`, `user_id`, `created_at`, `usage_count`
- **자동 업데이트**: `updated_at`

### FR-PT-04: 템플릿 삭제
- **권한**: 본인 소유 템플릿만 삭제 가능
- **Soft delete**: `status`를 `deleted`로 변경 (물리 삭제 아님)
- **복구 가능**: 관리자가 `status`를 `active`로 변경하여 복구 가능

### FR-PT-05: 변수 자동 감지
- **패턴**: `{{변수명}}` 형식 (이중 중괄호)
- **추출**: 정규식으로 모든 변수 추출
- **저장**: `variables` 필드에 JSON 배열로 저장
- **검증**: 변수명은 영문, 숫자, 언더스코어만 허용 (`/^[a-zA-Z0-9_]+$/`)

**예시**:
```json
{
  "variables": [
    { "name": "project_name", "label": "프로젝트명", "type": "text" },
    { "name": "budget", "label": "예산", "type": "number" },
    { "name": "duration", "label": "기간 (개월)", "type": "number" }
  ]
}
```

### FR-PT-06: 변수 렌더링
- **입력**: 템플릿 + 변수 값 객체
- **출력**: 렌더링된 프롬프트 문자열
- **에러 처리**: 필수 변수 누락 시 에러 메시지
- **미리보기**: 실시간 렌더링 결과 표시

### FR-PT-07: 카테고리 분류
- **rfp**: RFP 생성 템플릿
- **requirements**: 요구사항 분석 템플릿
- **plan**: 프로젝트 계획 템플릿
- **report**: 보고서 작성 템플릿
- **chat**: 일반 채팅 템플릿
- **custom**: 사용자 정의 템플릿

### FR-PT-08: 사용 횟수 추적
- **트리거**: 템플릿으로 AI 생성 실행 시
- **증가**: `usage_count` 필드 +1
- **통계**: 가장 많이 사용된 템플릿 조회 가능

### FR-PT-09: 팀 공개 설정
- **플래그**: `is_public` (boolean)
- **기본값**: `false` (비공개)
- **변경**: 템플릿 편집 화면에서 토글 가능
- **권한**: 소유자만 변경 가능

### FR-PT-10: 템플릿 복사
- **시나리오**: 시스템 템플릿 또는 팀 템플릿을 내 템플릿으로 복사
- **동작**: 새 템플릿 생성 (user_id는 현재 사용자)
- **이름**: "복사본 - {원본 이름}" 형식

---

## 4. 비기능 요구사항

### NFR-PT-01: 성능
- 템플릿 목록 조회: 500ms 이내
- 변수 렌더링: 100ms 이내
- 템플릿 저장: 1초 이내
- 페이지네이션: 20개씩

### NFR-PT-02: 보안
- **RLS (Row Level Security)** 적용
  - 본인 템플릿: 전체 접근 (CRUD)
  - 팀 공개 템플릿: 읽기 전용
  - 시스템 템플릿: 읽기 전용
- **SQL Injection 방어**: 파라미터 바인딩 사용
- **XSS 방어**: 템플릿 렌더링 시 이스케이프 처리

### NFR-PT-03: 접근성
- **키보드 네비게이션**: 템플릿 목록, 생성/편집 폼
- **스크린 리더**: 모든 입력 필드에 적절한 label
- **ARIA 속성**: 다이얼로그, 토글 버튼

### NFR-PT-04: 사용성
- **직관적인 UI**: 템플릿 생성/편집은 최대 3단계 이내
- **에러 메시지**: 사용자 친화적이고 구체적인 안내
- **로딩 상태**: 스켈레톤 또는 스피너 표시
- **성공 피드백**: 토스트 알림

### NFR-PT-05: 확장성
- **변수 타입 확장 가능**: text, number, date, select 등
- **카테고리 확장 가능**: 새로운 Minu 서비스 추가 시
- **다국어 지원 가능**: i18n 구조 고려

---

## 5. 우선순위

| 우선순위 | 기능 | 이유 | 목표 버전 |
|---------|------|------|----------|
| P0 | 템플릿 CRUD | 핵심 기능 | v2.16.0 |
| P0 | 변수 치환 | 핵심 가치 제공 | v2.16.0 |
| P1 | 팀 공유 | 협업 가치 | v2.16.0 |
| P1 | 시스템 템플릿 | 신규 사용자 온보딩 | v2.16.0 |
| P2 | 사용 통계 | 분석 및 개선 | v2.17.0 |
| P2 | 템플릿 복사 | 편의 기능 | v2.17.0 |

---

## 6. 제약사항

### 6.1 기술적 제약
- **Supabase RLS**: 팀 템플릿 접근 제어를 위해 `user_teams` 조인 필요
- **변수 렌더링**: 클라이언트 사이드에서 처리 (서버 렌더링 불필요)
- **저장 용량**: 템플릿당 최대 10KB (user_prompt_template + system_prompt)

### 6.2 비즈니스 제약
- **무료 플랜**: 템플릿 최대 10개
- **프로 플랜**: 템플릿 최대 100개
- **팀 공유**: 팀 구독이 있는 경우만 가능

### 6.3 시간적 제약
- **Phase 1**: v2.16.0 (2025-11-30 목표)
- **Phase 2**: v2.17.0 (2025-12-15 목표)

---

## 7. 데이터 모델 (개요)

```sql
-- 프롬프트 템플릿 테이블 (개념적 스키마)
prompt_templates (
  id uuid PRIMARY KEY,
  user_id uuid REFERENCES auth.users,  -- NULL이면 시스템 템플릿
  name text NOT NULL,
  description text,
  category text,  -- rfp, requirements, plan, report, chat, custom
  user_prompt_template text NOT NULL,
  system_prompt text,
  variables jsonb,  -- [{ name, label, type, required }]
  is_public boolean DEFAULT false,
  usage_count integer DEFAULT 0,
  status text DEFAULT 'active',  -- active, deleted
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
)
```

**상세 스키마는 `plan/` 단계에서 정의합니다.**

---

## 8. 사용 시나리오

### 시나리오 1: RFP 템플릿 생성 및 재사용
1. **상황**: PM이 정부 SI 프로젝트 RFP를 매달 작성해야 함
2. **생성**: 첫 RFP 작성 후 "템플릿으로 저장" 클릭, 변수 설정 (프로젝트명, 예산, 기간)
3. **재사용**: 다음달 새 프로젝트 시 템플릿 선택, 변수만 입력하여 RFP 생성
4. **효과**: 작업 시간 30분 → 5분 (83% 단축)

### 시나리오 2: 팀 베스트 프랙티스 공유
1. **상황**: 팀 리더가 좋은 요구사항 분석 템플릿을 발견
2. **공유**: 템플릿 편집에서 "팀과 공유" 토글 ON
3. **활용**: 팀원들이 "팀 공유" 탭에서 템플릿 확인 및 사용
4. **효과**: 팀 전체의 요구사항 문서 품질 향상

### 시나리오 3: 시스템 템플릿 커스터마이징
1. **상황**: 신규 사용자가 RFP 작성 필요
2. **발견**: "시스템 템플릿" 탭에서 "정부 SI RFP" 템플릿 발견
3. **커스터마이징**: "내 템플릿으로 복사" 클릭, 회사 정보 추가
4. **저장**: 수정된 템플릿을 "우리 회사 RFP" 이름으로 저장
5. **효과**: 처음부터 작성하지 않고 80% 완성된 템플릿으로 시작

---

## 9. 성공 지표

### 9.1 사용성 지표
- **템플릿 생성률**: 사용자의 30% 이상이 1개 이상 템플릿 생성
- **재사용률**: 템플릿당 평균 3회 이상 사용
- **팀 공유율**: 팀 사용자의 50% 이상이 공유 템플릿 활용

### 9.2 성능 지표
- **응답 시간**: 템플릿 목록 조회 P95 < 500ms
- **렌더링 속도**: 변수 10개 템플릿 렌더링 < 100ms

### 9.3 품질 지표
- **에러율**: 템플릿 생성/사용 에러 < 1%
- **만족도**: 사용자 설문 평균 4.0/5.0 이상

---

## 10. 참고 자료

### 10.1 관련 문서
- [Claude Integration 요구사항](../requirements.md)
- [AI Skills 명세](../../claude-skills/spec/requirements.md)
- [Minu Services 아키텍처](../../../plan/services/minu-architecture.md)

### 10.2 유사 사례
- **Notion**: 템플릿 갤러리, 변수 치환
- **GitHub Copilot**: 코드 스니펫 라이브러리
- **ChatGPT**: Custom Instructions (시스템 프롬프트 저장)

### 10.3 기술 참고
- [Mustache.js](https://github.com/janl/mustache.js/) - 변수 치환 라이브러리
- [Handlebars.js](https://handlebarsjs.com/) - 고급 템플릿 엔진
- [Supabase RLS](https://supabase.com/docs/guides/auth/row-level-security) - 보안 정책

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0.0 | 2025-11-25 | 초기 작성 - 5개 사용자 스토리, 10개 기능 요구사항 정의 | Claude |

---

**다음 단계**:
1. `acceptance-criteria.md` 작성 (BDD 형식 인수 조건)
2. `plan/architecture.md` 작성 (기술 설계)
3. `tasks/sprint-1.md` 작성 (구현 작업 분해)
