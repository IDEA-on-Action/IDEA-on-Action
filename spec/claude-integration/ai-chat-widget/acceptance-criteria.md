# AI 채팅 위젯 인수 조건

> Claude AI 통합 - 사이트 전역 채팅 위젯 검증 기준
>
> **Stage**: Specify (명세 작성)
> **작성일**: 2025-11-25
> **담당**: Claude & 서민원

---

## 📋 개요

이 문서는 AI 채팅 위젯이 요구사항을 충족하는지 검증하기 위한 인수 조건(Acceptance Criteria)을 정의합니다.

---

## ✅ AC-001: 플로팅 버튼 표시

### 조건
사이트의 모든 페이지에서 플로팅 버튼이 올바르게 표시되어야 함

### 검증 시나리오

#### 1. 위치 및 스타일
```
Given 사용자가 사이트의 임의의 페이지에 접속했을 때
When 페이지가 완전히 로드되면
Then 화면 우하단에 AI 어시스턴트 플로팅 버튼이 표시된다
And 버튼은 60x60px 크기(데스크톱) 또는 56x56px 크기(모바일)이다
And 버튼에는 Bot 아이콘(MessageCircle)이 표시된다
And 버튼의 배경색은 Primary 브랜드 색상이다
```

#### 2. 고정 위치
```
Given 플로팅 버튼이 표시된 상태에서
When 사용자가 페이지를 스크롤하면
Then 버튼은 화면에 계속 고정되어 있다
And 버튼의 위치는 변하지 않는다
```

#### 3. 호버 효과
```
Given 플로팅 버튼이 표시된 상태에서
When 사용자가 마우스를 버튼 위로 올리면
Then 버튼 배경색이 약간 어두워진다
And 커서가 포인터로 변경된다
```

#### 4. z-index
```
Given 페이지에 다른 요소들이 있을 때
When 플로팅 버튼이 표시되면
Then 버튼은 다른 모든 요소 위에 표시된다 (z-index: 1000)
```

#### 5. 모바일 레이아웃
```
Given 사용자가 모바일 기기로 접속했을 때
When 페이지가 로드되면
Then 플로팅 버튼이 화면 하단 중앙에 표시된다
And 버튼이 하단 네비게이션과 겹치지 않는다
```

---

## ✅ AC-002: 채팅 창 열기/닫기

### 조건
플로팅 버튼 클릭 시 채팅 창이 열리고, 닫기 버튼 클릭 시 닫혀야 함

### 검증 시나리오

#### 1. 채팅 창 열기
```
Given 플로팅 버튼이 표시된 상태에서
When 사용자가 플로팅 버튼을 클릭하면
Then 채팅 창이 Slide up 애니메이션(300ms)과 함께 열린다
And 채팅 창은 400x600px 크기(데스크톱)이다
And 채팅 창 헤더에 "AI 어시스턴트" 제목이 표시된다
And 채팅 창 본문에 환영 메시지가 표시된다
```

#### 2. 채팅 창 닫기
```
Given 채팅 창이 열린 상태에서
When 사용자가 헤더의 닫기 버튼(X)을 클릭하면
Then 채팅 창이 Slide down 애니메이션(300ms)과 함께 닫힌다
And 플로팅 버튼만 다시 표시된다
```

#### 3. ESC 키로 닫기
```
Given 채팅 창이 열린 상태에서
When 사용자가 ESC 키를 누르면
Then 채팅 창이 닫힌다
```

#### 4. 모바일 전체 화면
```
Given 모바일 사용자가 플로팅 버튼을 탭했을 때
When 채팅 창이 열리면
Then 채팅 창이 전체 화면으로 표시된다
And 채팅 창은 inset: 0으로 화면 전체를 덮는다
And 뒤의 콘텐츠는 스크롤되지 않는다 (body scroll lock)
```

#### 5. 토글 기능
```
Given 채팅 창이 닫힌 상태에서
When 사용자가 플로팅 버튼을 클릭하면
Then 채팅 창이 열린다

Given 채팅 창이 열린 상태에서
When 사용자가 플로팅 버튼을 다시 클릭하면
Then 채팅 창이 닫힌다
```

---

## ✅ AC-003: 메시지 전송

### 조건
사용자가 입력한 메시지를 AI에게 전송하고 응답을 받아야 함

### 검증 시나리오

#### 1. 메시지 입력 및 전송
```
Given 채팅 창이 열린 상태에서
When 사용자가 입력창에 "안녕하세요"를 입력하고
And 전송 버튼(Send)을 클릭하면
Then 사용자 메시지가 우측 정렬로 표시된다
And 메시지 배경색은 Primary 색상이다
And 입력창이 비워진다
And 전송 버튼이 비활성화된다 (로딩 중)
```

#### 2. Enter 키로 전송
```
Given 사용자가 입력창에 메시지를 입력했을 때
When Enter 키를 누르면
Then 메시지가 전송된다

Given 사용자가 입력창에 메시지를 입력했을 때
When Shift+Enter를 누르면
Then 줄바꿈이 입력된다 (전송되지 않음)
```

#### 3. 빈 메시지 방지
```
Given 사용자가 입력창에 공백만 입력했을 때
When 전송 버튼을 클릭하면
Then 메시지가 전송되지 않는다
And "메시지를 입력하세요" 경고가 표시된다
```

#### 4. 전송 중 중복 방지
```
Given 사용자가 메시지를 전송하고 응답을 기다리는 중일 때
When 다시 전송 버튼을 클릭하면
Then 아무 동작도 하지 않는다 (버튼 비활성화 상태)
```

---

## ✅ AC-004: 스트리밍 응답

### 조건
AI 응답이 실시간으로 스트리밍되어 표시되어야 함

### 검증 시나리오

#### 1. 스트리밍 시작
```
Given 사용자가 메시지를 전송했을 때
When AI 응답이 시작되면
Then AI 메시지 영역이 좌측 정렬로 생성된다
And Bot 아이콘이 표시된다
And 타이핑 애니메이션(...)이 표시된다
```

#### 2. 스트리밍 중
```
Given AI 응답이 스트리밍 중일 때
When 텍스트 청크가 도착하면
Then 메시지 내용이 실시간으로 업데이트된다
And 채팅 창이 자동으로 하단으로 스크롤된다
```

#### 3. 스트리밍 완료
```
Given AI 응답이 스트리밍 중일 때
When 응답이 완료되면
Then 타이핑 애니메이션이 사라진다
And 전송 버튼이 다시 활성화된다
And 메시지 하단에 타임스탬프가 표시된다
```

#### 4. 스트리밍 중지
```
Given AI 응답이 스트리밍 중일 때
When 사용자가 중지 버튼(Stop)을 클릭하면
Then 스트리밍이 즉시 중단된다
And 현재까지 받은 메시지만 표시된다
And 전송 버튼이 다시 활성화된다
```

#### 5. 마크다운 렌더링
```
Given AI 응답에 마크다운 문법이 포함되어 있을 때
When 응답이 완료되면
Then 마크다운이 HTML로 렌더링된다
And 코드 블록은 `<pre><code>`로 표시된다
And 링크는 클릭 가능하다
```

---

## ✅ AC-005: 대화 기록 저장

### 조건
로그인 사용자의 대화 내역이 자동으로 저장되어야 함

### 검증 시나리오

#### 1. 대화 세션 생성
```
Given 로그인한 사용자가 처음 채팅 창을 열었을 때
When AI와 첫 메시지를 주고받으면
Then 새로운 대화 세션이 자동 생성된다
And 대화 제목은 "AI 어시스턴트 대화 - {날짜}"이다
And 대화가 `ai_conversations` 테이블에 저장된다
```

#### 2. 메시지 저장
```
Given 대화 세션이 생성된 상태에서
When 사용자가 메시지를 전송하면
Then 사용자 메시지가 `ai_messages` 테이블에 저장된다
And role='user', content={메시지 내용}으로 저장된다

Given AI가 응답을 완료했을 때
Then AI 메시지가 `ai_messages` 테이블에 저장된다
And role='assistant', content={응답 내용}으로 저장된다
And token_count, model 정보가 함께 저장된다
```

#### 3. 대화 재개
```
Given 로그인한 사용자가 이전에 대화를 나눴을 때
When 채팅 창을 열고 "대화 기록" 버튼을 클릭하면
Then 이전 대화 세션 목록이 표시된다

Given 사용자가 특정 대화를 선택했을 때
When 해당 대화를 클릭하면
Then 이전 메시지들이 시간 순서대로 로드된다
And 사용자는 이어서 메시지를 전송할 수 있다
```

#### 4. 비회원 LocalStorage
```
Given 비회원 사용자가 채팅을 시작했을 때
When 메시지를 주고받으면
Then 메시지가 LocalStorage에 저장된다
And 키는 'ai-chat-session'이다
And 최대 50개 메시지만 유지된다

Given 비회원이 50개를 초과하는 메시지를 보냈을 때
Then 가장 오래된 메시지부터 삭제된다
```

#### 5. 로그인 후 마이그레이션
```
Given 비회원으로 대화를 나눈 후 로그인했을 때
When 채팅 창에 "로그인되었습니다. 대화를 저장하시겠습니까?" 알림이 표시되면
And 사용자가 "예"를 클릭하면
Then LocalStorage의 메시지가 DB로 이동된다
And LocalStorage가 비워진다
```

---

## ✅ AC-006: 페이지 컨텍스트 인식

### 조건
AI가 현재 페이지 정보를 자동으로 인식하고 맞춤 답변을 제공해야 함

### 검증 시나리오

#### 1. 서비스 페이지 인식
```
Given 사용자가 "/services/minu-find" 페이지에 있을 때
When 채팅 창을 열면
Then 시스템 프롬프트에 "Minu Find 서비스 전문가" 정보가 포함된다
And 환영 메시지가 "Minu Find에 대해 도와드릴까요?"로 표시된다
```

#### 2. 서비스별 맞춤 답변
```
Given 사용자가 "/services/minu-find" 페이지에서
When "시장 분석을 어떻게 하나요?"라고 질문하면
Then AI가 Minu Find의 시장분석 Excel 생성 기능을 안내한다
And 응답에 "/services/minu-find#market-analysis" 링크가 포함된다

Given 사용자가 "/services/minu-build" 페이지에서
When "프로젝트 리포트를 만들고 싶어요"라고 질문하면
Then AI가 Minu Build의 프로젝트 리포트 생성 기능을 안내한다
```

#### 3. 일반 페이지
```
Given 사용자가 "/" (홈) 페이지에 있을 때
When 채팅 창을 열면
Then 시스템 프롬프트가 일반 어시스턴트 역할이다
And 환영 메시지가 "IDEA on Action에 대해 궁금한 점이 있으신가요?"로 표시된다
```

#### 4. 페이지 이동 시 컨텍스트 변경
```
Given 사용자가 "/services/minu-find" 페이지에서 채팅 중일 때
When "/services/minu-build" 페이지로 이동하면
Then 시스템 프롬프트가 Minu Build 전문가로 변경된다
And 채팅 창에 "페이지가 변경되어 컨텍스트가 업데이트되었습니다" 알림이 표시된다 (선택)
```

---

## ✅ AC-007: 접근성

### 조건
키보드 및 스크린 리더 사용자도 위젯을 사용할 수 있어야 함

### 검증 시나리오

#### 1. 키보드 단축키
```
Given 사용자가 사이트에 접속했을 때
When Alt+C 키를 누르면
Then 채팅 창이 열린다

Given 채팅 창이 열린 상태에서
When Alt+C 키를 다시 누르면
Then 채팅 창이 닫힌다
```

#### 2. Tab 네비게이션
```
Given 채팅 창이 열린 상태에서
When Tab 키를 누르면
Then 포커스가 "대화 기록" 버튼 → 닫기 버튼 → 입력창 → 전송 버튼 순서로 이동한다
```

#### 3. ARIA 속성
```
Given 채팅 위젯이 렌더링되었을 때
Then 플로팅 버튼에 aria-label="AI 어시스턴트 열기"가 설정된다
And 입력창에 aria-label="메시지 입력"이 설정된다
And 메시지 목록에 role="log"가 설정된다
And 스트리밍 중인 메시지에 aria-live="polite"가 설정된다
```

#### 4. 스크린 리더 안내
```
Given 스크린 리더 사용자가 플로팅 버튼에 포커스했을 때
Then "AI 어시스턴트 열기, 버튼"이 읽힌다

Given 채팅 창이 열렸을 때
Then "AI 어시스턴트, 다이얼로그"가 읽힌다
```

---

## ✅ AC-008: 반응형 디자인

### 조건
모든 디바이스에서 올바르게 표시되어야 함

### 검증 시나리오

#### 1. 데스크톱 (1024px+)
```
Given 화면 너비가 1024px 이상일 때
Then 채팅 창이 400x600px 크기로 표시된다
And 채팅 창이 우하단에 플로팅으로 표시된다
And 플로팅 버튼이 우하단에 표시된다
```

#### 2. 태블릿 (768px ~ 1023px)
```
Given 화면 너비가 768px ~ 1023px일 때
Then 채팅 창이 350x500px 크기로 표시된다
And 채팅 창이 우하단에 플로팅으로 표시된다
```

#### 3. 모바일 (~ 767px)
```
Given 화면 너비가 767px 이하일 때
Then 채팅 창이 전체 화면으로 표시된다
And 플로팅 버튼이 하단 중앙에 표시된다
And 키보드가 나타나면 입력창이 키보드 위로 이동한다
```

#### 4. 가로/세로 모드
```
Given 모바일 사용자가 채팅 창을 열었을 때
When 기기를 가로 모드로 회전하면
Then 채팅 창이 여전히 전체 화면으로 표시된다
And 레이아웃이 가로 모드에 맞게 조정된다
```

---

## 📊 성능 기준

### 렌더링 성능
- 채팅 창 열기/닫기 애니메이션: 60fps 유지
- 메시지 100개 렌더링: < 100ms
- 스트리밍 텍스트 업데이트: < 16ms (프레임당)

### 네트워크 성능
- 첫 청크 응답 시간: < 1초 (p50)
- 전체 응답 완료: < 5초 (일반 답변)

### 번들 크기
- AI 채팅 위젯 청크: < 50KB gzip
- 총 번들 크기 증가: < 100KB gzip

---

## 🔗 관련 문서

- **요구사항**: [requirements.md](requirements.md)
- **아키텍처**: [../../plan/claude-integration/ai-chat-widget/architecture.md](../../plan/claude-integration/ai-chat-widget/architecture.md)
- **작업 계획**: [../../tasks/claude-integration/ai-chat-widget/sprint-1.md](../../tasks/claude-integration/ai-chat-widget/sprint-1.md)

---

## 📝 변경 이력

| 날짜 | 작성자 | 변경 내용 |
|------|--------|-----------|
| 2025-11-25 | Claude | 초안 작성 |
