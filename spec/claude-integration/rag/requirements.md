# RAG (Retrieval-Augmented Generation) 요구사항 명세서

> Claude AI에 RAG를 통합하여 문서 기반 컨텍스트 주입 및 지식 검색 기능 제공

**작성일**: 2025-11-25
**버전**: 1.0.0
**상태**: Draft
**관련 문서**: [Claude Integration 요구사항](../requirements.md), [AI Tool Use 요구사항](../../ai-tool-use/requirements.md)

---

## 1. 개요

### 1.1 목적

RAG(Retrieval-Augmented Generation)를 IDEA on Action 시스템에 통합하여, 업로드된 문서 및 프로젝트 지식 베이스를 기반으로 Claude AI가 더 정확하고 맥락에 맞는 답변을 제공합니다.

### 1.2 핵심 기능

| 기능 | 설명 | 우선순위 |
|------|------|----------|
| **문서 임베딩** | 업로드된 문서를 벡터로 변환하여 저장 | P0 |
| **유사도 검색** | 질문과 관련된 문서 조각 검색 | P0 |
| **컨텍스트 주입** | 검색된 문서를 Claude 프롬프트에 포함 | P0 |
| **하이브리드 검색** | 키워드 + 벡터 검색 결합 | P1 |
| **문서 관리** | 문서 업로드/삭제/버전 관리 | P1 |

### 1.3 대상 서비스

| 서비스 | RAG 활용 사례 | 문서 유형 |
|--------|-------------|-----------|
| **Minu Find** | 시장 조사 보고서, 경쟁사 분석 | PDF, Word |
| **Minu Frame** | RFP 템플릿, 요구사항 사례 | PDF, Word, Markdown |
| **Minu Build** | 프로젝트 문서, API 명세서 | Markdown, PDF |
| **Minu Keep** | 운영 매뉴얼, 장애 이력 | PDF, Word, 텍스트 |

---

## 2. 사용자 스토리

### US-RAG-01: 문서 기반 질의응답
> **As a** 비즈니스 분석가
> **I want to** 프로젝트 문서를 업로드하고 AI에게 질문
> **So that** 방대한 문서에서 필요한 정보를 빠르게 찾을 수 있다

**인수 조건**:
- [ ] PDF/Word/Markdown 파일 업로드 가능
- [ ] 업로드 시 자동으로 텍스트 추출 및 임베딩 생성
- [ ] 질문 시 관련 문서 조각을 자동으로 검색하여 답변에 포함
- [ ] 답변에 출처 문서 및 페이지 번호 표시

### US-RAG-02: 프로젝트 지식 베이스 구축
> **As a** 프로젝트 매니저
> **I want to** 팀의 프로젝트 문서들을 한 곳에 모아 관리
> **So that** AI가 프로젝트 맥락을 이해하고 일관된 답변을 제공할 수 있다

**인수 조건**:
- [ ] 프로젝트별 문서 컬렉션 생성 가능
- [ ] 문서 버전 관리 (업데이트 시 이전 버전 유지)
- [ ] 문서 태그 및 카테고리 분류
- [ ] 문서 검색 인터페이스 제공

### US-RAG-03: 다중 문서 종합 분석
> **As a** 사업 기획자
> **I want to** 여러 시장 조사 보고서를 기반으로 AI가 종합 분석
> **So that** 복수의 문서를 일일이 읽지 않고도 인사이트를 얻을 수 있다

**인수 조건**:
- [ ] 여러 문서를 동시에 선택하여 질문 가능
- [ ] 문서 간 교차 참조 및 비교 분석
- [ ] 종합 요약 및 인사이트 생성
- [ ] 출처 표시 (어느 문서에서 가져온 정보인지)

### US-RAG-04: 코드 베이스 질의응답
> **As a** 개발자
> **I want to** 프로젝트 코드를 기반으로 AI에게 질문
> **So that** 코드 구조와 로직을 빠르게 이해할 수 있다

**인수 조건**:
- [ ] GitHub 리포지토리 연동 (선택)
- [ ] 코드 파일 업로드 및 인덱싱
- [ ] 코드 스니펫 검색 및 설명
- [ ] 함수/클래스 관계 분석

### US-RAG-05: 장애 이력 기반 해결책 추천
> **As a** 운영 담당자
> **I want to** 과거 장애 이력을 기반으로 AI가 해결책 제안
> **So that** 유사한 장애 발생 시 빠르게 대응할 수 있다

**인수 조건**:
- [ ] 장애 로그 및 해결 기록 업로드
- [ ] 증상 입력 시 유사 과거 사례 검색
- [ ] 과거 해결 방법 및 권장 조치 제안
- [ ] 장애 패턴 분석

### US-RAG-06: RFP 템플릿 학습 및 생성
> **As a** 제안 담당자
> **I want to** 과거 성공한 RFP를 AI가 학습하여 새 RFP 생성
> **So that** 검증된 양식과 내용을 재사용할 수 있다

**인수 조건**:
- [ ] 과거 RFP 문서 업로드 및 분류 (성공/실패)
- [ ] 산업별/유형별 RFP 템플릿 학습
- [ ] 새 RFP 요청 시 유사 사례 참조하여 작성
- [ ] 템플릿 평가 기준 적용

### US-RAG-07: 실시간 문서 동기화
> **As a** 팀 리더
> **I want to** 외부 문서(Google Docs, Notion)를 자동 동기화
> **So that** 항상 최신 정보를 기반으로 AI가 답변할 수 있다

**인수 조건**:
- [ ] Google Drive 연동 (OAuth)
- [ ] Notion 연동 (API 키)
- [ ] 주기적 동기화 (일일/주간)
- [ ] 변경 감지 및 재임베딩

### US-RAG-08: 문서 권한 관리
> **As a** 관리자
> **I want to** 문서별 접근 권한 설정
> **So that** 민감한 정보를 권한 있는 사용자만 조회할 수 있다

**인수 조건**:
- [ ] 문서별 읽기/쓰기 권한 설정
- [ ] 팀/개인별 권한 부여
- [ ] RAG 검색 시 권한 필터링 자동 적용
- [ ] 감사 로그 기록

---

## 3. 기능 요구사항

### FR-RAG-01: 문서 처리 파이프라인

#### FR-RAG-01.1: 텍스트 추출

| 형식 | 라이브러리 | 우선순위 |
|------|-----------|----------|
| PDF | pdf-parse, pdfjs-dist | P0 |
| Word (.docx) | mammoth | P0 |
| Markdown | 기본 파싱 | P0 |
| 텍스트 (.txt) | 직접 읽기 | P0 |
| HTML | jsdom | P1 |
| 이미지 (OCR) | Tesseract.js | P2 |

#### FR-RAG-01.2: 텍스트 청킹

| 설정 | 값 | 설명 |
|------|------|------|
| 청크 크기 | 500-1000 토큰 | Claude 컨텍스트 윈도우 고려 |
| 오버랩 | 100 토큰 | 맥락 유지 |
| 분리 기준 | 문단, 제목 | 의미 단위 유지 |

#### FR-RAG-01.3: 메타데이터 추출

| 메타데이터 | 설명 | 사용 목적 |
|-----------|------|----------|
| 문서 제목 | 파일명 또는 추출된 제목 | 검색 필터링 |
| 작성일 | 파일 메타데이터 | 최신성 판단 |
| 페이지 번호 | PDF 페이지 번호 | 출처 표시 |
| 섹션 제목 | Markdown 헤딩 | 컨텍스트 |

### FR-RAG-02: 임베딩 생성

#### FR-RAG-02.1: 임베딩 모델

| 모델 | 차원 | 비용 (1M 토큰) | 선택 이유 |
|------|------|---------------|----------|
| text-embedding-3-small | 1536 | $0.02 | 성능/비용 균형 (기본) |
| text-embedding-3-large | 3072 | $0.13 | 고정밀 검색 필요 시 |

#### FR-RAG-02.2: 임베딩 저장

```sql
CREATE TABLE document_embeddings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  document_id UUID NOT NULL REFERENCES documents(id),
  chunk_index INTEGER NOT NULL,
  content TEXT NOT NULL,
  embedding VECTOR(1536) NOT NULL,
  metadata JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- pgvector 인덱스
CREATE INDEX ON document_embeddings USING ivfflat (embedding vector_cosine_ops);
```

### FR-RAG-03: 벡터 검색

#### FR-RAG-03.1: 유사도 검색

| 메트릭 | 설명 | 사용 시나리오 |
|--------|------|---------------|
| Cosine Similarity | 방향 유사도 | 기본 검색 |
| Euclidean Distance | 거리 기반 | 정확한 매칭 |
| Dot Product | 스칼라 곱 | 크기 고려 |

#### FR-RAG-03.2: 하이브리드 검색

```
Hybrid Score = α × Vector Score + (1-α) × Keyword Score
  - α = 0.7 (벡터 가중치, 조정 가능)
  - Keyword Score: PostgreSQL Full-Text Search
```

#### FR-RAG-03.3: 재순위화 (Re-ranking)

| 요소 | 가중치 | 설명 |
|------|--------|------|
| 유사도 점수 | 0.5 | 벡터 유사도 |
| 최신성 | 0.2 | 문서 작성일 |
| 문서 중요도 | 0.2 | 사용자 평가 |
| 권한 | 0.1 | 접근 권한 여부 |

### FR-RAG-04: 컨텍스트 주입

#### FR-RAG-04.1: 프롬프트 구조

```
[System Prompt]
당신은 전문 어시스턴트입니다. 아래 제공된 문서를 참고하여 답변하세요.

[Retrieved Context]
## 참고 문서 1
출처: {document_title} (페이지 {page_number})
내용: {chunk_content}

## 참고 문서 2
...

[User Question]
{user_query}

[Instructions]
- 제공된 문서를 기반으로 답변하세요
- 문서에 없는 내용은 추측하지 마세요
- 답변 끝에 출처를 명시하세요
```

#### FR-RAG-04.2: 컨텍스트 제한

| 제한 | 값 | 이유 |
|------|------|------|
| 최대 청크 수 | 5개 | 컨텍스트 윈도우 절약 |
| 최대 토큰 수 | 10,000 | Claude 200K 윈도우의 5% |
| 유사도 임계값 | 0.7 | 관련성 보장 |

### FR-RAG-05: 문서 관리

#### FR-RAG-05.1: 문서 CRUD

| 작업 | API | 설명 |
|------|-----|------|
| 업로드 | POST /api/documents | 파일 업로드 + 자동 임베딩 |
| 조회 | GET /api/documents | 문서 목록 조회 |
| 삭제 | DELETE /api/documents/:id | 문서 + 임베딩 삭제 |
| 업데이트 | PUT /api/documents/:id | 재임베딩 트리거 |

#### FR-RAG-05.2: 문서 검색

| 필터 | 설명 |
|------|------|
| 제목 검색 | 키워드 기반 |
| 날짜 범위 | 작성일/업로드일 |
| 태그 필터 | 사용자 정의 태그 |
| 타입 필터 | PDF/Word/Markdown |

---

## 4. 비기능 요구사항

### NFR-RAG-01: 성능

| 항목 | 목표 | 최대 허용 |
|------|------|----------|
| 임베딩 생성 시간 | 100 페이지 < 30초 | 60초 |
| 검색 응답 시간 | < 500ms | 2초 |
| 동시 검색 처리 | 50개 | 100개 |
| 문서 업로드 크기 | 10MB (권장) | 50MB |

### NFR-RAG-02: 정확도

| 메트릭 | 목표 |
|--------|------|
| Recall@5 | > 0.8 |
| Precision@5 | > 0.7 |
| MRR (Mean Reciprocal Rank) | > 0.75 |

### NFR-RAG-03: 확장성

| 항목 | 현재 | 1년 후 |
|------|------|--------|
| 문서 수 | 1,000 | 10,000 |
| 임베딩 수 | 100K | 1M |
| 사용자 수 | 100 | 1,000 |

### NFR-RAG-04: 비용 효율성

| 항목 | 예상 비용 (월) |
|------|---------------|
| OpenAI Embeddings (100K 문서) | $2 |
| pgvector 스토리지 (1M 임베딩) | $5 |
| Supabase 데이터베이스 | $25 (Pro 플랜) |
| **총계** | **$32** |

---

## 5. 비기능 요구사항 상세

### 5.1 데이터 보호

| 항목 | 정책 |
|------|------|
| 문서 암호화 | 저장 시 AES-256 |
| 임베딩 격리 | 사용자별 RLS |
| 문서 보관 | 삭제 요청 시 7일 후 완전 삭제 |
| 감사 로그 | 모든 문서 접근 기록 |

### 5.2 검색 품질

| 전략 | 설명 |
|------|------|
| 쿼리 확장 | 동의어, 유사어 자동 추가 |
| 부정 샘플링 | 관련 없는 문서 제외 학습 |
| 사용자 피드백 | 검색 결과 평가 수집 |

---

## 6. 우선순위 매트릭스

| 우선순위 | 기능 | 이유 |
|----------|------|------|
| **P0** | 문서 업로드 + 임베딩 | RAG 핵심 기능 |
| **P0** | 벡터 검색 | 검색 정확도 |
| **P0** | 컨텍스트 주입 | Claude 통합 |
| **P1** | 하이브리드 검색 | 정확도 향상 |
| **P1** | 문서 관리 UI | 사용성 |
| **P2** | 외부 동기화 | 편의 기능 |
| **P2** | OCR | 특수 케이스 |
| **P3** | 재순위화 | 고급 최적화 |

---

## 7. 용어 정의

| 용어 | 정의 |
|------|------|
| **RAG** | Retrieval-Augmented Generation (검색 증강 생성) |
| **Embedding** | 텍스트를 고차원 벡터로 변환한 표현 |
| **pgvector** | PostgreSQL용 벡터 검색 확장 |
| **Chunking** | 긴 문서를 작은 조각으로 분할 |
| **Cosine Similarity** | 두 벡터 간 코사인 각도 기반 유사도 |
| **Re-ranking** | 검색 결과를 추가 기준으로 재정렬 |
| **MRR** | Mean Reciprocal Rank (평균 역순위) |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0.0 | 2025-11-25 | 초기 작성 | Claude |
