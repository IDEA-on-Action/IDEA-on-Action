# Central Hub 인수 조건

> 각 기능의 성공 기준과 검증 방법

**작성일**: 2025-11-23
**버전**: 1.0.0
**관련 명세**: [requirements.md](requirements.md)

---

## 1. 웹훅 수신 시스템 (FR-01)

### AC-01.1: 이벤트 수신 엔드포인트

| ID | 조건 | 검증 방법 |
|----|------|----------|
| AC-01.1.1 | 유효한 서명의 POST 요청 시 200 OK 반환 | E2E 테스트 |
| AC-01.1.2 | 잘못된 서명 시 401 Unauthorized 반환 | E2E 테스트 |
| AC-01.1.3 | 5분 이상 지난 타임스탬프 시 401 반환 | E2E 테스트 |
| AC-01.1.4 | 필수 헤더 누락 시 400 Bad Request 반환 | E2E 테스트 |
| AC-01.1.5 | 응답 시간 100ms 이내 | 성능 테스트 |

### AC-01.2: 이벤트 저장

| ID | 조건 | 검증 방법 |
|----|------|----------|
| AC-01.2.1 | 모든 이벤트가 service_events 테이블에 저장됨 | DB 쿼리 |
| AC-01.2.2 | issue.created 이벤트 시 service_issues에도 저장 | DB 쿼리 |
| AC-01.2.3 | service.health 이벤트 시 service_health 업데이트 | DB 쿼리 |
| AC-01.2.4 | 저장 실패 시 500 에러 및 로그 기록 | 에러 로그 확인 |

---

## 2. 통합 인증 (US-01)

### AC-02.1: JWT 토큰 발급

| ID | 조건 | 검증 방법 |
|----|------|----------|
| AC-02.1.1 | OAuth 로그인 성공 시 JWT 토큰 발급 | 인증 테스트 |
| AC-02.1.2 | 토큰에 user_id, email, roles 포함 | 토큰 디코딩 |
| AC-02.1.3 | 토큰 만료 시 자동 갱신 | 세션 테스트 |
| AC-02.1.4 | 로그아웃 시 모든 서비스에서 세션 무효화 | 통합 테스트 |

---

## 3. 구독 기반 접근 제어 (US-02)

### AC-03.1: 권한 확인

| ID | 조건 | 검증 방법 |
|----|------|----------|
| AC-03.1.1 | 활성 구독자는 해당 서비스 기능 접근 가능 | 권한 테스트 |
| AC-03.1.2 | 만료된 구독은 기능 제한 | 권한 테스트 |
| AC-03.1.3 | 플랜 업그레이드 시 즉시 반영 | 통합 테스트 |
| AC-03.1.4 | 권한 정보 5분 캐싱 | 캐시 테스트 |

---

## 4. 진행 상태 수신 (US-03)

### AC-04.1: 실시간 상태 표시

| ID | 조건 | 검증 방법 |
|----|------|----------|
| AC-04.1.1 | 웹훅 수신 후 500ms 이내 UI 반영 | 성능 테스트 |
| AC-04.1.2 | 서비스별 필터링 동작 | UI 테스트 |
| AC-04.1.3 | 프로젝트별 필터링 동작 | UI 테스트 |
| AC-04.1.4 | 타임라인 뷰에서 시간순 정렬 | UI 테스트 |

---

## 5. 이슈 관리 (US-04)

### AC-05.1: 이슈 수신 및 알림

| ID | 조건 | 검증 방법 |
|----|------|----------|
| AC-05.1.1 | Critical 이슈 시 즉시 Slack 알림 | 알림 테스트 |
| AC-05.1.2 | 이슈 상태 변경 추적 가능 | DB 쿼리 |
| AC-05.1.3 | 담당자 할당 기능 동작 | UI 테스트 |
| AC-05.1.4 | 해결 시 resolved_at 타임스탬프 기록 | DB 쿼리 |

---

## 6. 서비스 헬스 모니터링 (US-05)

### AC-06.1: 헬스 상태 표시

| ID | 조건 | 검증 방법 |
|----|------|----------|
| AC-06.1.1 | 4개 서비스 상태 한 화면에 표시 | UI 테스트 |
| AC-06.1.2 | 5분간 ping 없으면 unknown 상태 | 타이머 테스트 |
| AC-06.1.3 | 상태 변경 시 관리자 알림 | 알림 테스트 |
| AC-06.1.4 | 마지막 ping 시간 표시 | UI 테스트 |

---

## 7. 보안 요구사항 (NFR-02)

### AC-07.1: 인증 및 인가

| ID | 조건 | 검증 방법 |
|----|------|----------|
| AC-07.1.1 | HMAC-SHA256 서명 검증 | 보안 테스트 |
| AC-07.1.2 | RLS 정책으로 데이터 접근 제한 | 권한 테스트 |
| AC-07.1.3 | 관리자만 모든 이벤트 조회 가능 | 권한 테스트 |
| AC-07.1.4 | 사용자는 자신의 이슈만 조회 | 권한 테스트 |

---

## 검증 일정

### Phase 1 완료 검증 (2025-11-23)

- [x] AC-01.1.1 ~ AC-01.1.5: 웹훅 엔드포인트 기본 동작
- [x] AC-01.2.1 ~ AC-01.2.4: 이벤트 저장 확인
- [x] AC-07.1.1: HMAC 서명 검증
- [x] AC-07.1.2 ~ AC-07.1.4: RLS 정책 확인

### Phase 2 검증 (예정)

- [ ] AC-02.1.1 ~ AC-02.1.4: JWT 토큰 통합
- [ ] AC-03.1.1 ~ AC-03.1.4: MCP 권한 확인

### Phase 3 검증 (예정)

- [ ] AC-04.1.1 ~ AC-04.1.4: 실시간 UI
- [ ] AC-05.1.1 ~ AC-05.1.4: 이슈 관리 UI
- [ ] AC-06.1.1 ~ AC-06.1.4: 헬스 대시보드

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0.0 | 2025-11-23 | 초기 작성 | Claude |
