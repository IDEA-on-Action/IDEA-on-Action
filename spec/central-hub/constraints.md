# Central Hub 제약사항

> 시스템 구현 시 고려해야 할 기술적, 비즈니스적 제약사항

**작성일**: 2025-11-23
**버전**: 1.0.0
**관련 명세**: [requirements.md](requirements.md)

---

## 1. 기술적 제약사항

### 1.1 Supabase 플랫폼 제약

| 항목 | 제약 | 영향 |
|------|------|------|
| Edge Function 실행 시간 | 최대 30초 | 대용량 배치 처리 불가 |
| Edge Function 메모리 | 150MB | 대용량 페이로드 처리 제한 |
| Realtime 채널 | 프로젝트당 200개 | 세분화된 구독 설계 필요 |
| DB 연결 | 풀링 60개 | 동시 요청 제한 고려 |
| 스토리지 | 1GB (무료) | 대용량 로그 저장 불가 |

### 1.2 Deno 런타임 제약

| 항목 | 제약 | 대응 방안 |
|------|------|----------|
| npm 패키지 | esm.sh 변환 필요 | Deno 호환 패키지 우선 |
| 파일 시스템 | 읽기 전용 | 환경 변수/DB 사용 |
| 네트워크 | 외부 API 호출 가능 | 타임아웃 설정 필수 |

### 1.3 브라우저/프론트엔드 제약

| 항목 | 제약 | 대응 방안 |
|------|------|----------|
| WebSocket | 동시 연결 6개 (브라우저) | 채널 멀티플렉싱 |
| LocalStorage | 5MB | 캐시 크기 제한 |
| 번들 크기 | 500KB 권장 | 코드 스플리팅 |

---

## 2. 비즈니스 제약사항

### 2.1 기존 시스템 호환성

| 항목 | 제약 | 이유 |
|------|------|------|
| 인증 시스템 | useAuth 훅 유지 | 기존 사용자 경험 보존 |
| MCP 서버 구조 | 기존 패턴 활용 | 일관된 아키텍처 |
| UI 컴포넌트 | shadcn/ui 사용 | 디자인 시스템 통일 |
| 라우팅 | React Router 유지 | 기존 URL 구조 보존 |

### 2.2 점진적 마이그레이션

| 원칙 | 설명 |
|------|------|
| 기존 기능 영향 최소화 | 새 기능은 기존 기능과 독립적으로 동작 |
| 롤백 가능 | 문제 발생 시 이전 상태로 복구 가능 |
| 기능 플래그 | 새 기능은 플래그로 활성화/비활성화 |

### 2.3 서비스 연동 제약

| 항목 | 제약 | 대응 방안 |
|------|------|----------|
| Minu 서비스 독립성 | 각 서비스는 독립 배포 | 느슨한 결합 설계 |
| 웹훅 신뢰성 | 네트워크 장애 가능 | 재시도 로직 |
| 비밀키 관리 | 서비스별 개별 키 | Supabase Secrets |

---

## 3. 성능 제약사항

### 3.1 응답 시간 요구사항

| 엔드포인트 | 목표 | 최대 허용 |
|-----------|------|----------|
| 웹훅 수신 | 50ms | 100ms |
| 실시간 이벤트 전파 | 300ms | 500ms |
| 대시보드 로딩 | 1초 | 3초 |
| 이벤트 목록 조회 | 200ms | 500ms |

### 3.2 처리량 요구사항

| 항목 | 목표 | 제한 요인 |
|------|------|----------|
| 동시 웹훅 처리 | 100 req/s | Edge Function 동시 실행 |
| DB 쓰기 | 50 writes/s | PostgreSQL 연결 풀 |
| Realtime 브로드캐스트 | 1000 msg/s | Supabase Realtime 제한 |

---

## 4. 보안 제약사항

### 4.1 인증/인가

| 항목 | 요구사항 | 구현 방법 |
|------|----------|----------|
| 웹훅 인증 | HMAC-SHA256 필수 | 헤더 서명 검증 |
| 타임스탬프 검증 | 5분 이내 요청만 허용 | 리플레이 공격 방지 |
| RLS | 모든 테이블 활성화 | Row Level Security |
| API 접근 | 인증된 사용자만 | JWT 검증 |

### 4.2 데이터 보호

| 항목 | 요구사항 | 구현 방법 |
|------|----------|----------|
| 비밀키 저장 | 환경 변수 사용 | Supabase Secrets |
| 로그 민감 정보 | 마스킹 처리 | 페이로드 필터링 |
| 전송 암호화 | TLS 1.2 이상 | HTTPS 강제 |

---

## 5. 확장성 제약사항

### 5.1 수평 확장 한계

| 항목 | 현재 | 확장 시 고려사항 |
|------|------|-----------------|
| Edge Function | 자동 스케일링 | 콜드 스타트 지연 |
| DB | 단일 PostgreSQL | 읽기 복제본 고려 |
| Realtime | 단일 채널 | 샤딩 전략 필요 |

### 5.2 새 서비스 추가 절차

1. `service_id` CHECK 제약에 새 서비스 추가
2. 해당 서비스에 `WEBHOOK_SECRET` 환경 변수 생성
3. 프론트엔드 서비스 페이지에 MCP 클라이언트 적용
4. 문서 업데이트

---

## 6. 운영 제약사항

### 6.1 모니터링

| 항목 | 도구 | 한계 |
|------|------|------|
| 에러 추적 | Sentry | 무료 플랜 이벤트 제한 |
| 로그 | Supabase Logs | 7일 보관 |
| 성능 | Supabase Dashboard | 기본 메트릭만 |

### 6.2 배포

| 항목 | 방법 | 제약 |
|------|------|------|
| Edge Function | `supabase functions deploy` | 롤백 수동 |
| DB 마이그레이션 | `supabase db push` | 되돌리기 어려움 |
| 프론트엔드 | Vercel | 빌드 시간 제한 |

---

## 7. 예산 제약사항

### 7.1 Supabase 무료 플랜 한계

| 항목 | 무료 한도 | 초과 시 |
|------|----------|---------|
| DB 크기 | 500MB | 유료 전환 필요 |
| 스토리지 | 1GB | 유료 전환 필요 |
| Edge Function 호출 | 500K/월 | 유료 전환 필요 |
| Realtime 메시지 | 2M/월 | 유료 전환 필요 |

### 7.2 비용 최적화 전략

- 이벤트 로그 30일 후 아카이브
- 헬스 체크 간격 1분 (과도한 호출 방지)
- 캐싱으로 DB 조회 최소화

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0.0 | 2025-11-23 | 초기 작성 | Claude |
